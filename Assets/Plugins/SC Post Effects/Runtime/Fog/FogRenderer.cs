using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Rendering;
using UnityEngine.Rendering.PostProcessing;

namespace SCPE
{
    public sealed class FogRenderer : PostProcessEffectRenderer<Fog>
    {
        Shader shader;
        private int skyboxTexID = Shader.PropertyToID("_SkyboxTex");

        struct MipLevel
        {
            internal int down;
            internal int up;
        }

        MipLevel[] m_Pyramid;
        const int k_MaxPyramidSize = 16;

        enum Pass
        {
            Prefilter,
            Downsample,
            Upsample,
            Blend,
            BlendScattering
        }

        public override void Init()
        {
            shader = Shader.Find(ShaderNames.Fog);

            m_Pyramid = new MipLevel[k_MaxPyramidSize];

            for (int i = 0; i < k_MaxPyramidSize; i++)
            {
                m_Pyramid[i] = new MipLevel
                {
                    down = Shader.PropertyToID("_BloomMipDown" + i),
                    up = Shader.PropertyToID("_BloomMipUp" + i)
                };
            }
        }
        
        //Unable to reference a mesh anywhere, except through a Monobehaviour, creating it from precomputed arrays instead
        //Mesh is a geosphere with 12 segments. Unable to extract the actual skybox mesh that Unity uses internally
        private static readonly Vector3[] skySphereVertices = new Vector3[] { new Vector3(7.629511E-06f, 0.5f, 7.629511E-06f), new Vector3(-0.02829786f, 0.4915007f, -0.08719768f), new Vector3(-0.09169909f, 0.4915007f, 7.629511E-06f), new Vector3(-0.120798f, 0.477203f, -0.08779278f), new Vector3(-0.1803998f, 0.4662928f, 7.629511E-06f), new Vector3(-0.120798f, 0.477203f, 0.08779278f), new Vector3(-0.02829786f, 0.4915007f, 0.08719768f), new Vector3(7.629511E-06f, 0.5f, 7.629511E-06f), new Vector3(-0.05570306f, 0.4662928f, -0.1715038f), new Vector3(-0.2105974f, 0.4447929f, -0.08840314f), new Vector3(-0.1491951f, 0.4447929f, -0.1729992f), new Vector3(-0.2105974f, 0.4447929f, 0.08840314f), new Vector3(-0.2629053f, 0.4253071f, 7.629511E-06f), new Vector3(-0.05570306f, 0.4662928f, 0.1715038f), new Vector3(-0.1491951f, 0.4447929f, 0.1729992f), new Vector3(0.04610514f, 0.477203f, -0.1419928f), new Vector3(0.07419699f, 0.4915007f, -0.0539025f), new Vector3(7.629511E-06f, 0.5f, 7.629511E-06f), new Vector3(0.1458991f, 0.4662928f, -0.1059968f), new Vector3(0.01900511f, 0.4447929f, -0.2275959f), new Vector3(0.1184024f, 0.4447929f, -0.1952926f), new Vector3(-0.08120088f, 0.4253071f, -0.2499962f), new Vector3(0.2127031f, 0.4253071f, -0.1545052f), new Vector3(0.2223926f, 0.4447929f, -0.0523003f), new Vector3(0.2902037f, 0.3944076f, -0.1010071f), new Vector3(0.09160754f, 0.4026932f, -0.281796f), new Vector3(0.1856947f, 0.3944076f, -0.2447929f), new Vector3(0.2721981f, 0.3699016f, -0.1977951f), new Vector3(-0.006294346f, 0.3944076f, -0.3072022f), new Vector3(0.3495003f, 0.3272069f, -0.1442054f), new Vector3(0.3632944f, 0.3401007f, -0.04869917f), new Vector3(0.4181048f, 0.2584039f, -0.09169909f), new Vector3(-0.1755016f, 0.3944076f, -0.2523003f), new Vector3(-0.1039979f, 0.3699016f, -0.3200046f), new Vector3(-0.2398032f, 0.4026932f, -0.1742046f), new Vector3(-0.2942016f, 0.3944076f, -0.08890669f), new Vector3(0.0660029f, 0.3401007f, -0.3605936f), new Vector3(-0.02919814f, 0.3272069f, -0.376997f), new Vector3(0.1585946f, 0.3401007f, -0.3305028f), new Vector3(0.2452049f, 0.3272069f, -0.2877928f), new Vector3(0.3225071f, 0.3019074f, -0.2342947f), new Vector3(0.3966964f, 0.2452049f, -0.1803998f), new Vector3(0.4488975f, 0.1663004f, -0.1442054f), new Vector3(0.466598f, 0.1728008f, -0.04869917f), new Vector3(0.4761044f, 0.119501f, -0.07979705f), new Vector3(0.467895f, 0.119501f, -0.1198062f), new Vector3(0.4826047f, 0.08319981f, -0.1010071f), new Vector3(0.4526055f, 0.07799649f, -0.1977951f), new Vector3(0.4508965f, 0.119501f, -0.1726024f), new Vector3(0.4315023f, 0.119501f, -0.2177996f), new Vector3(0.4141985f, 0.1534066f, -0.2342947f), new Vector3(0.361799f, 0.2235981f, -0.2629053f), new Vector3(0.2940948f, 0.2452049f, -0.3215f), new Vector3(0.4073015f, 0.119501f, -0.2600061f), new Vector3(0.3993057f, 0.07990387f, -0.2900969f), new Vector3(0.3507973f, 0.1534066f, -0.3215f), new Vector3(0.3731975f, 0.119501f, -0.3070039f), new Vector3(0.2165026f, 0.2584039f, -0.3693065f), new Vector3(0.3404974f, 0.119501f, -0.3429999f), new Vector3(0.275906f, 0.1663004f, -0.3823987f), new Vector3(0.1314031f, 0.2629053f, -0.4044938f), new Vector3(0.1905013f, 0.1728008f, -0.4288014f), new Vector3(0.04200046f, 0.2584039f, -0.4259937f), new Vector3(0.09789425f, 0.1728008f, -0.4588006f), new Vector3(0.001594568f, 0.1663004f, -0.4714961f), new Vector3(-0.04900435f, 0.2452049f, -0.4329976f), new Vector3(-0.1231937f, 0.3019074f, -0.3791028f), new Vector3(-0.1979934f, 0.3272069f, -0.3220951f), new Vector3(-0.265301f, 0.3401007f, -0.2528954f), new Vector3(-0.3225071f, 0.3401007f, -0.1740978f), new Vector3(-0.1381933f, 0.2235981f, -0.4253071f), new Vector3(-0.2149004f, 0.2452049f, -0.3791028f), new Vector3(-0.2842985f, 0.2584039f, -0.3200046f), new Vector3(-0.09479667f, 0.1534066f, -0.4662928f), new Vector3(-0.1973983f, 0.1534066f, -0.4329976f), new Vector3(-0.3440986f, 0.2629053f, -0.2499962f), new Vector3(-0.2783932f, 0.1663004f, -0.3805982f), new Vector3(-0.3489052f, 0.1728008f, -0.3137026f), new Vector3(-0.3675059f, 0.3272069f, -0.08879988f), new Vector3(-0.392195f, 0.2584039f, -0.1715038f), new Vector3(-0.406096f, 0.1728008f, -0.234905f), new Vector3(-0.4479972f, 0.1663004f, -0.1471962f), new Vector3(-0.3363928f, 0.3699016f, 7.629511E-06f), new Vector3(-0.426894f, 0.2452049f, -0.08719768f), new Vector3(-0.2942016f, 0.3944076f, 0.08890669f), new Vector3(-0.3986038f, 0.3019074f, 7.629511E-06f), new Vector3(-0.2398032f, 0.4026932f, 0.1742046f), new Vector3(-0.3675059f, 0.3272069f, 0.08879988f), new Vector3(-0.3225071f, 0.3401007f, 0.1740978f), new Vector3(-0.4472038f, 0.2235981f, 7.629511E-06f), new Vector3(-0.426894f, 0.2452049f, 0.08719768f), new Vector3(-0.4727932f, 0.1534066f, -0.0539025f), new Vector3(-0.392195f, 0.2584039f, 0.1715038f), new Vector3(-0.4727932f, 0.1534066f, 0.0539025f), new Vector3(-0.4479972f, 0.1663004f, 0.1471962f), new Vector3(-0.1755016f, 0.3944076f, 0.2523003f), new Vector3(-0.265301f, 0.3401007f, 0.2528954f), new Vector3(-0.3440986f, 0.2629053f, 0.2499962f), new Vector3(-0.406096f, 0.1728008f, 0.234905f), new Vector3(-0.08120088f, 0.4253071f, 0.2499962f), new Vector3(-0.1979934f, 0.3272069f, 0.3220951f), new Vector3(-0.2842985f, 0.2584039f, 0.3200046f), new Vector3(-0.3489052f, 0.1728008f, 0.3137026f), new Vector3(-0.2783932f, 0.1663004f, 0.3805982f), new Vector3(-0.1039979f, 0.3699016f, 0.3200046f), new Vector3(-0.2149004f, 0.2452049f, 0.3791028f), new Vector3(-0.1231937f, 0.3019074f, 0.3791028f), new Vector3(0.01900511f, 0.4447929f, 0.2275959f), new Vector3(-0.006294346f, 0.3944076f, 0.3072022f), new Vector3(-0.02919814f, 0.3272069f, 0.376997f), new Vector3(0.04610514f, 0.477203f, 0.1419928f), new Vector3(0.07419699f, 0.4915007f, 0.0539025f), new Vector3(7.629511E-06f, 0.5f, 7.629511E-06f), new Vector3(-0.1381933f, 0.2235981f, 0.4253071f), new Vector3(-0.1973983f, 0.1534066f, 0.4329976f), new Vector3(-0.04900435f, 0.2452049f, 0.4329976f), new Vector3(-0.09479667f, 0.1534066f, 0.4662928f), new Vector3(0.09160754f, 0.4026932f, 0.281796f), new Vector3(0.1184024f, 0.4447929f, 0.1952926f), new Vector3(0.0660029f, 0.3401007f, 0.3605936f), new Vector3(0.04200046f, 0.2584039f, 0.4259937f), new Vector3(0.1458991f, 0.4662928f, 0.1059968f), new Vector3(0.001594568f, 0.1663004f, 0.4714961f), new Vector3(0.1856947f, 0.3944076f, 0.2447929f), new Vector3(0.1585946f, 0.3401007f, 0.3305028f), new Vector3(0.1314031f, 0.2629053f, 0.4044938f), new Vector3(0.2127031f, 0.4253071f, 0.1545052f), new Vector3(0.09789425f, 0.1728008f, 0.4588006f), new Vector3(0.1493019f, 0.477203f, 7.629511E-06f), new Vector3(0.07419699f, 0.4915007f, -0.0539025f), new Vector3(7.629511E-06f, 0.5f, 7.629511E-06f), new Vector3(0.1458991f, 0.4662928f, -0.1059968f), new Vector3(0.2223926f, 0.4447929f, -0.0523003f), new Vector3(0.2223926f, 0.4447929f, 0.0523003f), new Vector3(0.2963989f, 0.4026932f, 7.629511E-06f), new Vector3(0.2902037f, 0.3944076f, -0.1010071f), new Vector3(0.3632944f, 0.3401007f, -0.04869917f), new Vector3(0.2902037f, 0.3944076f, 0.1010071f), new Vector3(0.3632944f, 0.3401007f, 0.04869917f), new Vector3(0.2721981f, 0.3699016f, 0.1977951f), new Vector3(0.4253071f, 0.2629053f, 7.629511E-06f), new Vector3(0.4181048f, 0.2584039f, -0.09169909f), new Vector3(0.466598f, 0.1728008f, -0.04869917f), new Vector3(0.3495003f, 0.3272069f, 0.1442054f), new Vector3(0.2452049f, 0.3272069f, 0.2877928f), new Vector3(0.4181048f, 0.2584039f, 0.09169909f), new Vector3(0.3225071f, 0.3019074f, 0.2342947f), new Vector3(0.2165026f, 0.2584039f, 0.3693065f), new Vector3(0.466598f, 0.1728008f, 0.04869917f), new Vector3(0.3966964f, 0.2452049f, 0.1803998f), new Vector3(0.2940948f, 0.2452049f, 0.3215f), new Vector3(0.275906f, 0.1663004f, 0.3823987f), new Vector3(0.1905013f, 0.1728008f, 0.4288014f), new Vector3(0.361799f, 0.2235981f, 0.2629053f), new Vector3(0.4488975f, 0.1663004f, 0.1442054f), new Vector3(0.3507973f, 0.1534066f, 0.3215f), new Vector3(0.4141985f, 0.1534066f, 0.2342947f), new Vector3(0.4315023f, 0.119501f, 0.2177996f), new Vector3(0.4073015f, 0.119501f, 0.2600061f), new Vector3(0.3993057f, 0.07990387f, 0.2900969f), new Vector3(0.3731975f, 0.119501f, 0.3070039f), new Vector3(0.3278935f, 0.07799649f, 0.3693065f), new Vector3(0.3404974f, 0.119501f, 0.3429999f), new Vector3(0.3034943f, 0.119501f, 0.3753948f), new Vector3(0.2586023f, 0.119501f, 0.4080034f), new Vector3(0.245098f, 0.08319981f, 0.4277943f), new Vector3(0.223003f, 0.119501f, 0.4282063f), new Vector3(0.1673075f, 0.119501f, 0.4530022f), new Vector3(0.1522927f, 0.08500038f, 0.4685969f), new Vector3(0.1308995f, 0.119501f, 0.4647974f), new Vector3(0.07120623f, 0.119501f, 0.4774929f), new Vector3(0.05309376f, 0.08319981f, 0.4902037f), new Vector3(0.03060197f, 0.119501f, 0.4819944f), new Vector3(-0.02480354f, 0.119501f, 0.4821012f), new Vector3(-0.07380026f, 0.119501f, 0.4777066f), new Vector3(-0.04819562f, 0.07799649f, 0.4915007f), new Vector3(-0.1525063f, 0.07990387f, 0.4694057f), new Vector3(-0.1213932f, 0.119501f, 0.4678035f), new Vector3(-0.1767071f, 0.119501f, 0.4497978f), new Vector3(-0.2499046f, 0.07799649f, 0.4259937f), new Vector3(-0.221004f, 0.119501f, 0.4297932f), new Vector3(-0.2633021f, 0.119501f, 0.4047074f), new Vector3(-0.3081025f, 0.119501f, 0.3720073f), new Vector3(-0.3310979f, 0.08319981f, 0.3652934f), new Vector3(-0.3383001f, 0.119501f, 0.3444037f), new Vector3(-0.3791028f, 0.119501f, 0.2990997f), new Vector3(-0.3986038f, 0.08500038f, 0.2895933f), new Vector3(-0.4015946f, 0.119501f, 0.2680934f), new Vector3(-0.4320973f, 0.119501f, 0.2152972f), new Vector3(-0.4497978f, 0.08319981f, 0.2020066f), new Vector3(-0.4490044f, 0.119501f, 0.1780957f), new Vector3(-0.4662013f, 0.119501f, 0.1254063f), new Vector3(-0.4770962f, 0.119501f, 0.07740139f), new Vector3(-0.4824063f, 0.07799649f, 0.1059968f), new Vector3(-0.4936065f, 0.07990387f, 7.629511E-06f), new Vector3(-0.4824063f, 0.119501f, 0.02899977f), new Vector3(-0.4824063f, 0.119501f, -0.02899977f), new Vector3(-0.4824063f, 0.07799649f, -0.1059968f), new Vector3(-0.4770962f, 0.119501f, -0.07740139f), new Vector3(-0.4662013f, 0.119501f, -0.1254063f), new Vector3(-0.4490044f, 0.119501f, -0.1780957f), new Vector3(-0.4497978f, 0.08319981f, -0.2020066f), new Vector3(-0.4320973f, 0.119501f, -0.2152972f), new Vector3(-0.4015946f, 0.119501f, -0.2680934f), new Vector3(-0.3986038f, 0.08500038f, -0.2895933f), new Vector3(-0.3791028f, 0.119501f, -0.2990997f), new Vector3(-0.3383001f, 0.119501f, -0.3444037f), new Vector3(-0.3310979f, 0.08319981f, -0.3652934f), new Vector3(-0.3081025f, 0.119501f, -0.3720073f), new Vector3(-0.2633021f, 0.119501f, -0.4047074f), new Vector3(-0.221004f, 0.119501f, -0.4297932f), new Vector3(-0.2499046f, 0.07799649f, -0.4259937f), new Vector3(-0.1525063f, 0.07990387f, -0.4694057f), new Vector3(-0.1767071f, 0.119501f, -0.4497978f), new Vector3(-0.1213932f, 0.119501f, -0.4678035f), new Vector3(-0.04819562f, 0.07799649f, -0.4915007f), new Vector3(-0.07380026f, 0.119501f, -0.4777066f), new Vector3(-0.02480354f, 0.119501f, -0.4821012f), new Vector3(0.03060197f, 0.119501f, -0.4819944f), new Vector3(0.05309376f, 0.08319981f, -0.4902037f), new Vector3(0.07120623f, 0.119501f, -0.4774929f), new Vector3(0.1308995f, 0.119501f, -0.4647974f), new Vector3(0.1522927f, 0.08500038f, -0.4685969f), new Vector3(0.1673075f, 0.119501f, -0.4530022f), new Vector3(0.223003f, 0.119501f, -0.4282063f), new Vector3(0.245098f, 0.08319981f, -0.4277943f), new Vector3(0.2586023f, 0.119501f, -0.4080034f), new Vector3(0.3034943f, 0.119501f, -0.3753948f), new Vector3(0.3278935f, 0.07799649f, -0.3693065f), new Vector3(0.3128939f, 0.04369421f, -0.3847944f), new Vector3(0.3471046f, 0.04369421f, -0.3540017f), new Vector3(0.268307f, 0.04369421f, -0.416701f), new Vector3(0.2253071f, 0.04369421f, -0.4414969f), new Vector3(0.3041962f, 0.02370489f, -0.3937972f), new Vector3(0.3867018f, 0.04369421f, -0.3102998f), new Vector3(0.3583047f, 0.02370489f, -0.3451057f), new Vector3(0.2938964f, 7.629511E-06f, -0.4044938f), new Vector3(0.3715953f, 7.629511E-06f, -0.3346075f), new Vector3(0.2799954f, 0.02370489f, -0.4111009f), new Vector3(0.2033951f, 7.629511E-06f, -0.4568017f), new Vector3(0.2152972f, 0.02370489f, -0.4485008f), new Vector3(0.1771038f, 0.04369421f, -0.4629053f), new Vector3(0.4145952f, 0.04369421f, -0.2718929f), new Vector3(0.3798047f, 0.02370489f, -0.3213932f), new Vector3(0.423003f, 0.02370489f, -0.2618982f), new Vector3(0.4329976f, 7.629511E-06f, -0.2499962f), new Vector3(0.4439994f, 0.04369421f, -0.2208057f), new Vector3(0.1890974f, 0.02370489f, -0.4600977f), new Vector3(0.1039979f, 7.629511E-06f, -0.489105f), new Vector3(0.1173953f, 0.02370489f, -0.4833982f), new Vector3(0.4389944f, 0.02370489f, -0.2340963f), new Vector3(0.475494f, 7.629511E-06f, -0.1545052f), new Vector3(0.462707f, 0.04369421f, -0.178706f), new Vector3(0.4685054f, 0.02370489f, -0.1677043f), new Vector3(0.4792019f, 0.04369421f, -0.1263981f), new Vector3(0.4895934f, 0.04369421f, -0.07779812f), new Vector3(0.4931029f, 0.02370489f, -0.06609445f), new Vector3(0.4774929f, 0.02370489f, -0.1392004f), new Vector3(0.4972992f, 7.629511E-06f, -0.0523003f), new Vector3(0.4927977f, -0.02359808f, -0.06850538f), new Vector3(0.4775998f, -0.02359808f, -0.1397955f), new Vector3(0.4895018f, -0.04079499f, -0.0803006f), new Vector3(0.4682002f, -0.02359808f, -0.1679942f), new Vector3(0.4790951f, -0.04079499f, -0.1292058f), new Vector3(0.4824063f, -0.07799649f, -0.1059968f), new Vector3(0.4629053f, -0.04079499f, -0.1778058f), new Vector3(0.4497978f, -0.08319981f, -0.2020066f), new Vector3(0.4378042f, -0.02359808f, -0.2364004f), new Vector3(0.441207f, -0.04079499f, -0.2264973f), new Vector3(0.4235065f, -0.02359808f, -0.260998f), new Vector3(0.4165026f, -0.04079499f, -0.2689937f), new Vector3(0.3986038f, -0.08500038f, -0.2895933f), new Vector3(0.3791028f, -0.02359808f, -0.3220951f), new Vector3(0.384596f, -0.04079499f, -0.3130007f), new Vector3(0.3601053f, -0.02359808f, -0.3433051f), new Vector3(0.3516976f, -0.04079499f, -0.3496071f), new Vector3(0.3310979f, -0.08319981f, -0.3652934f), new Vector3(0.3043946f, -0.02359808f, -0.3934005f), new Vector3(0.3121004f, -0.04079499f, -0.3852979f), new Vector3(0.2806058f, -0.02359808f, -0.4109941f), new Vector3(0.2709011f, -0.04079499f, -0.4156939f), new Vector3(0.2174029f, -0.02359808f, -0.4474937f), new Vector3(0.2277028f, -0.04079499f, -0.4407035f), new Vector3(0.2499046f, -0.07799649f, -0.4259937f), new Vector3(0.1525063f, -0.07990387f, -0.4694057f), new Vector3(0.1773938f, -0.04079499f, -0.4631952f), new Vector3(0.188304f, -0.02359808f, -0.4604944f), new Vector3(0.1182956f, -0.02359808f, -0.4833066f), new Vector3(0.1287938f, -0.04079499f, -0.4790036f), new Vector3(0.04819562f, -0.07799649f, -0.4915007f), new Vector3(0.07480735f, -0.04079499f, -0.4902953f), new Vector3(0.08710612f, -0.02359808f, -0.489807f), new Vector3(7.629511E-06f, 7.629511E-06f, -0.5f), new Vector3(0.01459525f, -0.02359808f, -0.497406f), new Vector3(0.02520027f, -0.04079499f, -0.4956054f), new Vector3(-0.0150988f, -0.02359808f, -0.4972076f), new Vector3(-0.1039979f, 7.629511E-06f, -0.489105f), new Vector3(-0.02599374f, -0.04079499f, -0.4951934f), new Vector3(-0.05309376f, -0.08319981f, -0.4902037f), new Vector3(-0.08950179f, -0.02359808f, -0.489395f), new Vector3(-0.07900359f, -0.04079499f, -0.4895934f), new Vector3(-0.1173953f, -0.02359808f, -0.4833982f), new Vector3(-0.1271f, -0.04079499f, -0.4792935f), new Vector3(-0.1522927f, -0.08500038f, -0.4685969f), new Vector3(-0.1787976f, -0.04079499f, -0.4624933f), new Vector3(-0.1892042f, -0.02359808f, -0.4600977f), new Vector3(-0.2033951f, 7.629511E-06f, -0.4568017f), new Vector3(-0.2152056f, -0.02359808f, -0.4485008f), new Vector3(-0.2237964f, -0.04079499f, -0.4425956f), new Vector3(-0.245098f, -0.08319981f, -0.4277943f), new Vector3(-0.2700008f, -0.04079499f, -0.4159075f), new Vector3(-0.2801022f, -0.02359808f, -0.4111009f), new Vector3(-0.2938964f, 7.629511E-06f, -0.4044938f), new Vector3(-0.3041962f, -0.02359808f, -0.393904f), new Vector3(-0.3117037f, -0.04079499f, -0.3861067f), new Vector3(-0.3487984f, -0.04079499f, -0.3527047f), new Vector3(-0.3583963f, -0.02359808f, -0.3451057f), new Vector3(-0.3715953f, 7.629511E-06f, -0.3346075f), new Vector3(-0.3278935f, -0.07799649f, -0.3693065f), new Vector3(-0.3993057f, -0.07990387f, -0.2900969f), new Vector3(-0.3856947f, -0.04079499f, -0.311902f), new Vector3(-0.3798047f, -0.02359808f, -0.3213932f), new Vector3(-0.4158007f, -0.04079499f, -0.2705043f), new Vector3(-0.4526055f, -0.07799649f, -0.1977951f), new Vector3(-0.4432059f, -0.04079499f, -0.2226978f), new Vector3(-0.4230945f, -0.02359808f, -0.2618982f), new Vector3(-0.4329976f, 7.629511E-06f, -0.2499962f), new Vector3(-0.4389029f, -0.02359808f, -0.2342031f), new Vector3(-0.475494f, 7.629511E-06f, -0.1545052f), new Vector3(-0.4685969f, -0.02359808f, -0.1675975f), new Vector3(-0.4635004f, -0.04079499f, -0.1771038f), new Vector3(-0.4774929f, -0.02359808f, -0.1393072f), new Vector3(-0.4972992f, 7.629511E-06f, -0.0523003f), new Vector3(-0.4790036f, -0.04079499f, -0.1283055f), new Vector3(-0.4826047f, -0.08319981f, -0.1010071f), new Vector3(-0.4931029f, -0.02359808f, -0.06609445f), new Vector3(-0.4900969f, -0.04079499f, -0.07610437f), new Vector3(-0.4960021f, -0.02359808f, -0.03769741f), new Vector3(-0.4951018f, -0.04079499f, -0.02719921f), new Vector3(-0.4927062f, -0.08500038f, 7.629511E-06f), new Vector3(-0.4951018f, -0.04079499f, 0.02719921f), new Vector3(-0.4960021f, -0.02359808f, 0.03769741f), new Vector3(-0.4972992f, 7.629511E-06f, 0.0523003f), new Vector3(-0.4931029f, -0.02359808f, 0.06609445f), new Vector3(-0.4900969f, -0.04079499f, 0.07610437f), new Vector3(-0.4826047f, -0.08319981f, 0.1010071f), new Vector3(-0.4790036f, -0.04079499f, 0.1283055f), new Vector3(-0.4774929f, -0.02359808f, 0.1393072f), new Vector3(-0.475494f, 7.629511E-06f, 0.1545052f), new Vector3(-0.4685969f, -0.02359808f, 0.1675975f), new Vector3(-0.4635004f, -0.04079499f, 0.1771038f), new Vector3(-0.4432059f, -0.04079499f, 0.2226978f), new Vector3(-0.4389029f, -0.02359808f, 0.2342031f), new Vector3(-0.4329976f, 7.629511E-06f, 0.2499962f), new Vector3(-0.4526055f, -0.07799649f, 0.1977951f), new Vector3(-0.3993057f, -0.07990387f, 0.2900969f), new Vector3(-0.4158007f, -0.04079499f, 0.2705043f), new Vector3(-0.4230945f, -0.02359808f, 0.2618982f), new Vector3(-0.3856947f, -0.04079499f, 0.311902f), new Vector3(-0.3278935f, -0.07799649f, 0.3693065f), new Vector3(-0.3487984f, -0.04079499f, 0.3527047f), new Vector3(-0.3798047f, -0.02359808f, 0.3213932f), new Vector3(-0.3715953f, 7.629511E-06f, 0.3346075f), new Vector3(-0.3583963f, -0.02359808f, 0.3451057f), new Vector3(-0.2938964f, 7.629511E-06f, 0.4044938f), new Vector3(-0.3041962f, -0.02359808f, 0.393904f), new Vector3(-0.3117037f, -0.04079499f, 0.3861067f), new Vector3(-0.2801022f, -0.02359808f, 0.4111009f), new Vector3(-0.2033951f, 7.629511E-06f, 0.4568017f), new Vector3(-0.2700008f, -0.04079499f, 0.4159075f), new Vector3(-0.245098f, -0.08319981f, 0.4277943f), new Vector3(-0.2152056f, -0.02359808f, 0.4485008f), new Vector3(-0.2237964f, -0.04079499f, 0.4425956f), new Vector3(-0.1892042f, -0.02359808f, 0.4600977f), new Vector3(-0.1787976f, -0.04079499f, 0.4624933f), new Vector3(-0.1522927f, -0.08500038f, 0.4685969f), new Vector3(-0.1271f, -0.04079499f, 0.4792935f), new Vector3(-0.1173953f, -0.02359808f, 0.4833982f), new Vector3(-0.1039979f, 7.629511E-06f, 0.489105f), new Vector3(-0.08950179f, -0.02359808f, 0.489395f), new Vector3(-0.07900359f, -0.04079499f, 0.4895934f), new Vector3(-0.05309376f, -0.08319981f, 0.4902037f), new Vector3(-0.02599374f, -0.04079499f, 0.4951934f), new Vector3(-0.0150988f, -0.02359808f, 0.4972076f), new Vector3(7.629511E-06f, 7.629511E-06f, 0.5f), new Vector3(0.01459525f, -0.02359808f, 0.497406f), new Vector3(0.02520027f, -0.04079499f, 0.4956054f), new Vector3(0.07480735f, -0.04079499f, 0.4902953f), new Vector3(0.08710612f, -0.02359808f, 0.489807f), new Vector3(0.1039979f, 7.629511E-06f, 0.489105f), new Vector3(0.04819562f, -0.07799649f, 0.4915007f), new Vector3(0.1525063f, -0.07990387f, 0.4694057f), new Vector3(0.1287938f, -0.04079499f, 0.4790036f), new Vector3(0.1182956f, -0.02359808f, 0.4833066f), new Vector3(0.1773938f, -0.04079499f, 0.4631952f), new Vector3(0.2499046f, -0.07799649f, 0.4259937f), new Vector3(0.2277028f, -0.04079499f, 0.4407035f), new Vector3(0.188304f, -0.02359808f, 0.4604944f), new Vector3(0.2033951f, 7.629511E-06f, 0.4568017f), new Vector3(0.2174029f, -0.02359808f, 0.4474937f), new Vector3(0.2938964f, 7.629511E-06f, 0.4044938f), new Vector3(0.2806058f, -0.02359808f, 0.4109941f), new Vector3(0.2709011f, -0.04079499f, 0.4156939f), new Vector3(0.3043946f, -0.02359808f, 0.3934005f), new Vector3(0.3715953f, 7.629511E-06f, 0.3346075f), new Vector3(0.3121004f, -0.04079499f, 0.3852979f), new Vector3(0.3310979f, -0.08319981f, 0.3652934f), new Vector3(0.3601053f, -0.02359808f, 0.3433051f), new Vector3(0.3516976f, -0.04079499f, 0.3496071f), new Vector3(0.3791028f, -0.02359808f, 0.3220951f), new Vector3(0.384596f, -0.04079499f, 0.3130007f), new Vector3(0.3986038f, -0.08500038f, 0.2895933f), new Vector3(0.4165026f, -0.04079499f, 0.2689937f), new Vector3(0.4235065f, -0.02359808f, 0.260998f), new Vector3(0.4329976f, 7.629511E-06f, 0.2499962f), new Vector3(0.4378042f, -0.02359808f, 0.2364004f), new Vector3(0.441207f, -0.04079499f, 0.2264973f), new Vector3(0.4497978f, -0.08319981f, 0.2020066f), new Vector3(0.4629053f, -0.04079499f, 0.1778058f), new Vector3(0.4682002f, -0.02359808f, 0.1679942f), new Vector3(0.475494f, 7.629511E-06f, 0.1545052f), new Vector3(0.4775998f, -0.02359808f, 0.1397955f), new Vector3(0.4790951f, -0.04079499f, 0.1292058f), new Vector3(0.4895018f, -0.04079499f, 0.0803006f), new Vector3(0.4927977f, -0.02359808f, 0.06850538f), new Vector3(0.4972992f, 7.629511E-06f, 0.0523003f), new Vector3(0.4824063f, -0.07799649f, 0.1059968f), new Vector3(0.4936065f, -0.07990387f, 7.629511E-06f), new Vector3(0.495407f, -0.04079499f, 0.02559701f), new Vector3(0.4962005f, -0.02359808f, 0.03679713f), new Vector3(0.495407f, -0.04079499f, -0.02559701f), new Vector3(0.4962005f, -0.02359808f, -0.03679713f), new Vector3(0.4824063f, -0.07799649f, -0.1059968f), new Vector3(0.4895018f, -0.04079499f, -0.0803006f), new Vector3(0.4927977f, -0.02359808f, -0.06850538f), new Vector3(0.4972992f, 7.629511E-06f, -0.0523003f), new Vector3(0.4765011f, -0.1243992f, -0.07390707f), new Vector3(0.4810025f, -0.1243992f, -0.03269245f), new Vector3(0.4727932f, -0.1534066f, -0.0539025f), new Vector3(0.4810025f, -0.1243992f, 0.03269245f), new Vector3(0.4765011f, -0.1243992f, 0.07390707f), new Vector3(0.4727932f, -0.1534066f, 0.0539025f), new Vector3(0.4642939f, -0.1243992f, 0.1276951f), new Vector3(0.4479972f, -0.1663004f, 0.1471962f), new Vector3(0.4472038f, -0.2235981f, 7.629511E-06f), new Vector3(0.426894f, -0.2452049f, -0.08719768f), new Vector3(0.4488975f, -0.1243992f, 0.1747997f), new Vector3(0.426894f, -0.2452049f, 0.08719768f), new Vector3(0.3986038f, -0.3019074f, 7.629511E-06f), new Vector3(0.3675059f, -0.3272069f, -0.08879988f), new Vector3(0.4297017f, -0.1243992f, 0.2170977f), new Vector3(0.406096f, -0.1728008f, 0.234905f), new Vector3(0.392195f, -0.2584039f, 0.1715038f), new Vector3(0.3363928f, -0.3699016f, 7.629511E-06f), new Vector3(0.2942016f, -0.3944076f, -0.08890669f), new Vector3(0.3675059f, -0.3272069f, 0.08879988f), new Vector3(0.4020066f, -0.1243992f, 0.2649958f), new Vector3(0.2629053f, -0.4253071f, 7.629511E-06f), new Vector3(0.2105974f, -0.4447929f, -0.08840314f), new Vector3(0.2942016f, -0.3944076f, 0.08890669f), new Vector3(0.3225071f, -0.3401007f, 0.1740978f), new Vector3(0.3762951f, -0.1243992f, 0.3003967f), new Vector3(0.3440986f, -0.2629053f, 0.2499962f), new Vector3(0.3489052f, -0.1728008f, 0.3137026f), new Vector3(0.1803998f, -0.4662928f, 7.629511E-06f), new Vector3(0.120798f, -0.477203f, -0.08779278f), new Vector3(0.2105974f, -0.4447929f, 0.08840314f), new Vector3(0.3393072f, -0.1243992f, 0.3415961f), new Vector3(0.2398032f, -0.4026932f, 0.1742046f), new Vector3(0.265301f, -0.3401007f, 0.2528954f), new Vector3(0.09169909f, -0.4915007f, 7.629511E-06f), new Vector3(0.02829786f, -0.4915007f, -0.08719768f), new Vector3(7.629511E-06f, -0.5f, 7.629511E-06f), new Vector3(0.3048981f, -0.1243992f, 0.3729076f), new Vector3(0.2842985f, -0.2584039f, 0.3200046f), new Vector3(0.2783932f, -0.1663004f, 0.3805982f), new Vector3(0.120798f, -0.477203f, 0.08779278f), new Vector3(0.2649043f, -0.1243992f, 0.4020981f), new Vector3(0.1973983f, -0.1534066f, 0.4329976f), new Vector3(0.2176013f, -0.1243992f, 0.4302968f), new Vector3(0.2149004f, -0.2452049f, 0.3791028f), new Vector3(0.02829786f, -0.4915007f, 0.08719768f), new Vector3(7.629511E-06f, -0.5f, 7.629511E-06f), new Vector3(0.1491951f, -0.4447929f, 0.1729992f), new Vector3(0.1796979f, -0.1243992f, 0.4474021f), new Vector3(0.1175937f, -0.1243992f, 0.4676051f), new Vector3(0.07689784f, -0.1243992f, 0.4759976f), new Vector3(0.09479667f, -0.1534066f, 0.4662928f), new Vector3(0.02199588f, -0.1243992f, 0.4810025f), new Vector3(-0.001594568f, -0.1663004f, 0.4714961f), new Vector3(0.1381933f, -0.2235981f, 0.4253071f), new Vector3(-0.02750439f, -0.1243992f, 0.4808957f), new Vector3(0.04900435f, -0.2452049f, 0.4329976f), new Vector3(0.1231937f, -0.3019074f, 0.3791028f), new Vector3(-0.07369345f, -0.1243992f, 0.4757992f), new Vector3(-0.09789425f, -0.1728008f, 0.4588006f), new Vector3(-0.04200046f, -0.2584039f, 0.4259937f), new Vector3(-0.1278019f, -0.1243992f, 0.4642023f), new Vector3(-0.169398f, -0.1243992f, 0.4506981f), new Vector3(-0.1905013f, -0.1728008f, 0.4288014f), new Vector3(-0.2199969f, -0.1243992f, 0.4282063f), new Vector3(-0.2604028f, -0.1243992f, 0.4051957f), new Vector3(-0.275906f, -0.1663004f, 0.3823987f), new Vector3(-0.1314031f, -0.2629053f, 0.4044938f), new Vector3(0.02919814f, -0.3272069f, 0.376997f), new Vector3(-0.3005951f, -0.1243992f, 0.3762036f), new Vector3(-0.3507973f, -0.1534066f, 0.3215f), new Vector3(-0.3419928f, -0.1243992f, 0.3399023f), new Vector3(-0.2165026f, -0.2584039f, 0.3693065f), new Vector3(-0.0660029f, -0.3401007f, 0.3605936f), new Vector3(-0.2940948f, -0.2452049f, 0.3215f), new Vector3(-0.1585946f, -0.3401007f, 0.3305028f), new Vector3(-0.3699016f, -0.1243992f, 0.3092012f), new Vector3(-0.4082933f, -0.1243992f, 0.2562982f), new Vector3(-0.428893f, -0.1243992f, 0.2201953f), new Vector3(-0.4141985f, -0.1534066f, 0.2342947f), new Vector3(-0.4506981f, -0.1243992f, 0.1695964f), new Vector3(-0.4488975f, -0.1663004f, 0.1442054f), new Vector3(-0.361799f, -0.2235981f, 0.2629053f), new Vector3(-0.4658961f, -0.1243992f, 0.1224002f), new Vector3(-0.3966964f, -0.2452049f, 0.1803998f), new Vector3(-0.3225071f, -0.3019074f, 0.2342947f), new Vector3(-0.4752041f, -0.1243992f, 0.07689784f), new Vector3(-0.466598f, -0.1728008f, 0.04869917f), new Vector3(-0.4181048f, -0.2584039f, 0.09169909f), new Vector3(-0.4810025f, -0.1243992f, 0.02190433f), new Vector3(-0.4810025f, -0.1243992f, -0.02190433f), new Vector3(-0.466598f, -0.1728008f, -0.04869917f), new Vector3(-0.4752041f, -0.1243992f, -0.07689784f), new Vector3(-0.4658961f, -0.1243992f, -0.1224002f), new Vector3(-0.4488975f, -0.1663004f, -0.1442054f), new Vector3(-0.4253071f, -0.2629053f, 7.629511E-06f), new Vector3(-0.3495003f, -0.3272069f, 0.1442054f), new Vector3(-0.4506981f, -0.1243992f, -0.1695964f), new Vector3(-0.4141985f, -0.1534066f, -0.2342947f), new Vector3(-0.428893f, -0.1243992f, -0.2201953f), new Vector3(-0.4181048f, -0.2584039f, -0.09169909f), new Vector3(-0.3632944f, -0.3401007f, 0.04869917f), new Vector3(-0.3966964f, -0.2452049f, -0.1803998f), new Vector3(-0.3632944f, -0.3401007f, -0.04869917f), new Vector3(-0.4082933f, -0.1243992f, -0.2562982f), new Vector3(-0.3699016f, -0.1243992f, -0.3092012f), new Vector3(-0.3419928f, -0.1243992f, -0.3399023f), new Vector3(-0.3507973f, -0.1534066f, -0.3215f), new Vector3(-0.3005951f, -0.1243992f, -0.3762036f), new Vector3(-0.275906f, -0.1663004f, -0.3823987f), new Vector3(-0.361799f, -0.2235981f, -0.2629053f), new Vector3(-0.2604028f, -0.1243992f, -0.4051957f), new Vector3(-0.2940948f, -0.2452049f, -0.3215f), new Vector3(-0.3225071f, -0.3019074f, -0.2342947f), new Vector3(-0.2199969f, -0.1243992f, -0.4282063f), new Vector3(-0.1905013f, -0.1728008f, -0.4288014f), new Vector3(-0.2165026f, -0.2584039f, -0.3693065f), new Vector3(-0.169398f, -0.1243992f, -0.4506981f), new Vector3(-0.1278019f, -0.1243992f, -0.4642023f), new Vector3(-0.09789425f, -0.1728008f, -0.4588006f), new Vector3(-0.07369345f, -0.1243992f, -0.4757992f), new Vector3(-0.02750439f, -0.1243992f, -0.4808957f), new Vector3(-0.001594568f, -0.1663004f, -0.4714961f), new Vector3(-0.1314031f, -0.2629053f, -0.4044938f), new Vector3(-0.2452049f, -0.3272069f, -0.2877928f), new Vector3(0.02199588f, -0.1243992f, -0.4810025f), new Vector3(0.09479667f, -0.1534066f, -0.4662928f), new Vector3(0.07689784f, -0.1243992f, -0.4759976f), new Vector3(-0.04200046f, -0.2584039f, -0.4259937f), new Vector3(-0.1585946f, -0.3401007f, -0.3305028f), new Vector3(0.04900435f, -0.2452049f, -0.4329976f), new Vector3(-0.0660029f, -0.3401007f, -0.3605936f), new Vector3(0.1175937f, -0.1243992f, -0.4676051f), new Vector3(0.1796979f, -0.1243992f, -0.4474021f), new Vector3(0.2176013f, -0.1243992f, -0.4302968f), new Vector3(0.1973983f, -0.1534066f, -0.4329976f), new Vector3(0.2649043f, -0.1243992f, -0.4020981f), new Vector3(0.2783932f, -0.1663004f, -0.3805982f), new Vector3(0.1381933f, -0.2235981f, -0.4253071f), new Vector3(0.3048981f, -0.1243992f, -0.3729076f), new Vector3(0.2149004f, -0.2452049f, -0.3791028f), new Vector3(0.1231937f, -0.3019074f, -0.3791028f), new Vector3(0.3393072f, -0.1243992f, -0.3415961f), new Vector3(0.3489052f, -0.1728008f, -0.3137026f), new Vector3(0.2842985f, -0.2584039f, -0.3200046f), new Vector3(0.3762951f, -0.1243992f, -0.3003967f), new Vector3(0.4020066f, -0.1243992f, -0.2649958f), new Vector3(0.406096f, -0.1728008f, -0.234905f), new Vector3(0.4297017f, -0.1243992f, -0.2170977f), new Vector3(0.4488975f, -0.1243992f, -0.1747997f), new Vector3(0.4479972f, -0.1663004f, -0.1471962f), new Vector3(0.4642939f, -0.1243992f, -0.1276951f), new Vector3(0.4765011f, -0.1243992f, -0.07390707f), new Vector3(0.4727932f, -0.1534066f, -0.0539025f), new Vector3(0.426894f, -0.2452049f, -0.08719768f), new Vector3(0.392195f, -0.2584039f, -0.1715038f), new Vector3(0.3675059f, -0.3272069f, -0.08879988f), new Vector3(0.3440986f, -0.2629053f, -0.2499962f), new Vector3(0.3225071f, -0.3401007f, -0.1740978f), new Vector3(0.2942016f, -0.3944076f, -0.08890669f), new Vector3(0.265301f, -0.3401007f, -0.2528954f), new Vector3(0.2398032f, -0.4026932f, -0.1742046f), new Vector3(0.2105974f, -0.4447929f, -0.08840314f), new Vector3(0.1979934f, -0.3272069f, -0.3220951f), new Vector3(0.1491951f, -0.4447929f, -0.1729992f), new Vector3(0.120798f, -0.477203f, -0.08779278f), new Vector3(0.1755016f, -0.3944076f, -0.2523003f), new Vector3(0.1039979f, -0.3699016f, -0.3200046f), new Vector3(0.05570306f, -0.4662928f, -0.1715038f), new Vector3(0.02829786f, -0.4915007f, -0.08719768f), new Vector3(0.08120088f, -0.4253071f, -0.2499962f), new Vector3(0.02919814f, -0.3272069f, -0.376997f), new Vector3(0.006294346f, -0.3944076f, -0.3072022f), new Vector3(-0.01900511f, -0.4447929f, -0.2275959f), new Vector3(-0.09160754f, -0.4026932f, -0.281796f), new Vector3(-0.04610514f, -0.477203f, -0.1419928f), new Vector3(-0.1184024f, -0.4447929f, -0.1952926f), new Vector3(-0.1856947f, -0.3944076f, -0.2447929f), new Vector3(-0.07419699f, -0.4915007f, -0.0539025f), new Vector3(7.629511E-06f, -0.5f, 7.629511E-06f), new Vector3(-0.1458991f, -0.4662928f, -0.1059968f), new Vector3(-0.2127031f, -0.4253071f, -0.1545052f), new Vector3(-0.2721981f, -0.3699016f, -0.1977951f), new Vector3(-0.3495003f, -0.3272069f, -0.1442054f), new Vector3(-0.2902037f, -0.3944076f, -0.1010071f), new Vector3(-0.2223926f, -0.4447929f, -0.0523003f), new Vector3(-0.2963989f, -0.4026932f, 7.629511E-06f), new Vector3(-0.1493019f, -0.477203f, 7.629511E-06f), new Vector3(-0.2223926f, -0.4447929f, 0.0523003f), new Vector3(-0.2902037f, -0.3944076f, 0.1010071f), new Vector3(-0.07419699f, -0.4915007f, 0.0539025f), new Vector3(7.629511E-06f, -0.5f, 7.629511E-06f), new Vector3(-0.1458991f, -0.4662928f, 0.1059968f), new Vector3(-0.2127031f, -0.4253071f, 0.1545052f), new Vector3(-0.2721981f, -0.3699016f, 0.1977951f), new Vector3(-0.2452049f, -0.3272069f, 0.2877928f), new Vector3(-0.1856947f, -0.3944076f, 0.2447929f), new Vector3(-0.1184024f, -0.4447929f, 0.1952926f), new Vector3(-0.09160754f, -0.4026932f, 0.281796f), new Vector3(-0.04610514f, -0.477203f, 0.1419928f), new Vector3(-0.01900511f, -0.4447929f, 0.2275959f), new Vector3(0.006294346f, -0.3944076f, 0.3072022f), new Vector3(7.629511E-06f, -0.5f, 7.629511E-06f), new Vector3(0.05570306f, -0.4662928f, 0.1715038f), new Vector3(0.08120088f, -0.4253071f, 0.2499962f), new Vector3(0.1039979f, -0.3699016f, 0.3200046f), new Vector3(0.1755016f, -0.3944076f, 0.2523003f), new Vector3(0.1979934f, -0.3272069f, 0.3220951f), new Vector3(0.1287938f, 0.04369421f, -0.4786068f), new Vector3(0.07729457f, 0.04369421f, -0.4895934f), new Vector3(0.08950179f, 0.02370489f, -0.489395f), new Vector3(0.02790112f, 0.04369421f, -0.4947967f), new Vector3(0.0150988f, 0.02370489f, -0.4972076f), new Vector3(-0.02700084f, 0.04369421f, -0.4951934f), new Vector3(-0.01470207f, 0.02370489f, -0.497406f), new Vector3(-0.07279316f, 0.04369421f, -0.4904021f), new Vector3(-0.08699931f, 0.02370489f, -0.489807f), new Vector3(-0.1184024f, 0.02370489f, -0.4831998f), new Vector3(-0.1305028f, 0.04369421f, -0.4783017f), new Vector3(-0.188304f, 0.02370489f, -0.4604944f), new Vector3(-0.1755932f, 0.04369421f, -0.4636988f), new Vector3(-0.2174945f, 0.02370489f, -0.4474021f), new Vector3(-0.2293965f, 0.04369421f, -0.439498f), new Vector3(-0.280499f, 0.02370489f, -0.4109941f), new Vector3(-0.2692989f, 0.04369421f, -0.4165026f), new Vector3(-0.3045014f, 0.02370489f, -0.3932936f), new Vector3(-0.3133974f, 0.04369421f, -0.3838941f), new Vector3(-0.3599985f, 0.02370489f, -0.3433051f), new Vector3(-0.3502937f, 0.04369421f, -0.3507057f), new Vector3(-0.3791028f, 0.02370489f, -0.3220035f), new Vector3(-0.3854963f, 0.04369421f, -0.3115053f), new Vector3(-0.4152972f, 0.04369421f, -0.2703975f), new Vector3(-0.4233997f, 0.02370489f, -0.2611048f), new Vector3(-0.4418021f, 0.04369421f, -0.2248035f), new Vector3(-0.4378042f, 0.02370489f, -0.2362936f), new Vector3(-0.462005f, 0.04369421f, -0.1793927f), new Vector3(-0.4682002f, 0.02370489f, -0.1679942f), new Vector3(-0.4794003f, 0.04369421f, -0.1274052f), new Vector3(-0.4775998f, 0.02370489f, -0.1397955f), new Vector3(-0.4889067f, 0.04369421f, -0.08240635f), new Vector3(-0.4927062f, 0.02370489f, -0.06859693f), new Vector3(-0.4962005f, 0.02370489f, -0.03670558f), new Vector3(-0.4951934f, 0.04369421f, -0.02370489f), new Vector3(-0.4962005f, 0.02370489f, 0.03670558f), new Vector3(-0.4951934f, 0.04369421f, 0.02370489f), new Vector3(-0.4927062f, 0.02370489f, 0.06859693f), new Vector3(-0.4889067f, 0.04369421f, 0.08240635f), new Vector3(-0.4775998f, 0.02370489f, 0.1397955f), new Vector3(-0.4794003f, 0.04369421f, 0.1274052f), new Vector3(-0.4682002f, 0.02370489f, 0.1679942f), new Vector3(-0.462005f, 0.04369421f, 0.1793927f), new Vector3(-0.4378042f, 0.02370489f, 0.2362936f), new Vector3(-0.4418021f, 0.04369421f, 0.2248035f), new Vector3(-0.4233997f, 0.02370489f, 0.2611048f), new Vector3(-0.4152972f, 0.04369421f, 0.2703975f), new Vector3(-0.3854963f, 0.04369421f, 0.3115053f), new Vector3(-0.3791028f, 0.02370489f, 0.3220035f), new Vector3(-0.3502937f, 0.04369421f, 0.3507057f), new Vector3(-0.3599985f, 0.02370489f, 0.3433051f), new Vector3(-0.3133974f, 0.04369421f, 0.3838941f), new Vector3(-0.3045014f, 0.02370489f, 0.3932936f), new Vector3(-0.2692989f, 0.04369421f, 0.4165026f), new Vector3(-0.280499f, 0.02370489f, 0.4109941f), new Vector3(-0.2293965f, 0.04369421f, 0.439498f), new Vector3(-0.2174945f, 0.02370489f, 0.4474021f), new Vector3(-0.188304f, 0.02370489f, 0.4604944f), new Vector3(-0.1755932f, 0.04369421f, 0.4636988f), new Vector3(-0.1184024f, 0.02370489f, 0.4831998f), new Vector3(-0.1305028f, 0.04369421f, 0.4783017f), new Vector3(-0.08699931f, 0.02370489f, 0.489807f), new Vector3(-0.07279316f, 0.04369421f, 0.4904021f), new Vector3(-0.01470207f, 0.02370489f, 0.497406f), new Vector3(-0.02700084f, 0.04369421f, 0.4951934f), new Vector3(0.0150988f, 0.02370489f, 0.4972076f), new Vector3(0.02790112f, 0.04369421f, 0.4947967f), new Vector3(0.08950179f, 0.02370489f, 0.489395f), new Vector3(0.07729457f, 0.04369421f, 0.4895934f), new Vector3(0.1173953f, 0.02370489f, 0.4833982f), new Vector3(0.1287938f, 0.04369421f, 0.4786068f), new Vector3(0.1771038f, 0.04369421f, 0.4629053f), new Vector3(0.1890974f, 0.02370489f, 0.4600977f), new Vector3(0.2253071f, 0.04369421f, 0.4414969f), new Vector3(0.2152972f, 0.02370489f, 0.4485008f), new Vector3(0.268307f, 0.04369421f, 0.416701f), new Vector3(0.2799954f, 0.02370489f, 0.4111009f), new Vector3(0.3128939f, 0.04369421f, 0.3847944f), new Vector3(0.3041962f, 0.02370489f, 0.3937972f), new Vector3(0.3471046f, 0.04369421f, 0.3540017f), new Vector3(0.3583047f, 0.02370489f, 0.3451057f), new Vector3(0.3798047f, 0.02370489f, 0.3213932f), new Vector3(0.3867018f, 0.04369421f, 0.3102998f), new Vector3(0.423003f, 0.02370489f, 0.2618982f), new Vector3(0.4389944f, 0.02370489f, 0.2340963f), new Vector3(0.4145952f, 0.04369421f, 0.2718929f), new Vector3(0.4439994f, 0.04369421f, 0.2208057f), new Vector3(0.4685054f, 0.02370489f, 0.1677043f), new Vector3(0.4526055f, 0.07799649f, 0.1977951f), new Vector3(0.4774929f, 0.02370489f, 0.1392004f), new Vector3(0.462707f, 0.04369421f, 0.178706f), new Vector3(0.4826047f, 0.08319981f, 0.1010071f), new Vector3(0.4508965f, 0.119501f, 0.1726024f), new Vector3(0.4792019f, 0.04369421f, 0.1263981f), new Vector3(0.467895f, 0.119501f, 0.1198062f), new Vector3(0.4931029f, 0.02370489f, 0.06609445f), new Vector3(0.4761044f, 0.119501f, 0.07979705f), new Vector3(0.4927062f, 0.08500038f, 7.629511E-06f), new Vector3(0.4895934f, 0.04369421f, 0.07779812f), new Vector3(0.4824979f, 0.119501f, 0.01909667f), new Vector3(0.4824979f, 0.119501f, -0.01909667f), new Vector3(0.4761044f, 0.119501f, -0.07979705f), new Vector3(0.4826047f, 0.08319981f, -0.1010071f), new Vector3(0.4960021f, 0.02370489f, 0.03769741f), new Vector3(0.4949035f, 0.04369421f, 0.02539864f), new Vector3(0.4949035f, 0.04369421f, -0.02539864f), new Vector3(0.4895934f, 0.04369421f, -0.07779812f), new Vector3(0.4960021f, 0.02370489f, -0.03769741f), new Vector3(0.4931029f, 0.02370489f, -0.06609445f)};
		private static readonly int[] skySphereTriangles = new int[] { 0,1,2,2,1,3,2,3,4,2,4,5,6,2,5,7,2,6,1,8,3,4,3,9,3,8,10,3,10,9,5,4,11,4,9,12,4,12,11,6,5,13,5,11,14,13,5,14,1,15,8,1,16,15,17,16,1,16,18,15,8,15,19,15,18,20,15,20,19,8,19,21,8,21,10,18,22,20,18,23,22,22,23,24,19,20,25,20,22,26,20,26,25,22,24,27,22,27,26,21,19,28,19,25,28,27,24,29,24,30,29,29,30,31,10,21,32,21,28,33,21,33,32,10,32,34,9,10,34,9,34,35,12,9,35,28,25,36,33,28,37,28,36,37,25,38,36,25,26,38,26,39,38,26,27,39,27,40,39,27,29,40,40,29,41,29,31,41,42,41,31,43,42,31,44,42,43,42,44,45,46,45,44,47,45,46,45,47,48,45,48,42,49,42,48,47,49,48,42,50,41,42,49,50,40,41,51,50,51,41,39,40,52,40,51,52,47,53,49,50,49,53,53,47,54,51,50,55,55,52,51,56,50,53,56,53,54,50,56,55,39,52,57,38,39,57,55,56,58,54,58,56,55,59,52,59,57,52,58,59,55,38,57,60,36,38,60,59,61,57,61,60,57,36,60,62,37,36,62,61,63,60,63,62,60,63,64,62,37,62,65,64,65,62,66,37,65,33,37,66,33,66,67,32,33,67,32,67,68,34,32,68,34,68,69,35,34,69,66,65,70,67,66,71,66,70,71,68,67,72,67,71,72,73,70,65,64,73,65,74,71,70,70,73,74,69,68,75,68,72,75,76,72,71,74,76,71,77,75,72,76,77,72,35,69,78,69,75,79,78,69,79,77,80,75,80,79,75,80,81,79,82,35,78,12,35,82,78,79,83,81,83,79,12,82,84,11,12,84,82,78,85,85,78,83,11,84,86,14,11,86,84,82,87,82,85,87,86,84,88,84,87,88,85,83,89,87,85,90,85,89,90,91,89,83,81,91,83,88,87,92,87,90,92,93,90,89,89,91,93,94,92,90,93,94,90,14,86,95,86,88,96,95,86,96,88,92,97,96,88,97,94,98,92,98,97,92,99,14,95,13,14,99,95,96,100,96,97,101,100,96,101,98,102,97,102,101,97,102,103,101,99,95,104,104,95,100,100,101,105,103,105,101,104,100,106,106,100,105,13,99,107,99,104,108,107,99,108,104,106,109,108,104,109,110,13,107,6,13,110,111,6,110,112,6,111,106,105,113,103,114,105,114,113,105,106,113,115,109,106,115,113,114,116,116,115,113,107,108,117,110,107,118,118,107,117,108,109,119,117,108,119,109,115,120,119,109,120,111,110,121,121,110,118,116,122,115,122,120,115,118,117,123,117,119,124,123,117,124,119,120,125,124,119,125,121,118,126,126,118,123,122,127,120,127,125,120,111,121,128,129,111,128,130,111,129,129,128,131,131,128,132,128,121,133,128,133,132,121,126,133,132,133,134,132,134,135,135,134,136,133,126,137,133,137,134,134,138,136,134,137,138,126,139,137,126,123,139,136,138,140,136,140,141,142,141,140,137,143,138,137,139,143,139,123,144,123,124,144,138,145,140,138,143,145,139,146,143,139,144,146,144,124,147,124,125,147,148,142,140,148,140,145,143,149,145,143,146,149,146,144,150,144,147,150,151,150,147,152,147,125,152,151,147,127,152,125,146,150,153,146,153,149,154,145,149,154,148,145,155,153,150,151,155,150,156,149,153,156,154,149,153,155,156,157,154,156,155,158,156,156,158,157,159,157,158,158,155,160,158,160,159,160,161,159,161,160,162,155,162,160,151,162,155,161,162,163,162,151,163,164,163,151,164,161,163,161,164,165,165,164,166,151,166,164,166,151,152,167,166,152,167,165,166,165,167,168,152,169,167,168,167,169,169,152,127,170,169,127,170,168,169,168,170,171,127,172,170,171,170,172,172,127,122,173,172,122,173,171,172,122,174,173,174,122,116,171,173,175,175,173,174,174,176,175,116,177,174,176,174,177,114,177,116,177,114,178,177,178,176,178,179,176,179,178,180,114,180,178,103,180,114,179,180,181,180,103,181,182,181,103,182,179,181,179,182,183,183,182,184,103,184,182,184,103,102,185,184,102,185,183,184,183,185,186,102,187,185,186,185,187,187,102,98,188,187,98,188,186,187,186,188,189,98,190,188,189,188,190,190,98,94,191,190,94,191,189,190,94,192,191,192,94,93,189,191,193,193,191,192,192,194,193,93,195,192,194,192,195,91,195,93,195,91,196,195,196,194,196,197,194,197,196,198,91,198,196,81,198,91,197,198,199,198,81,199,200,199,81,200,197,199,197,200,201,201,200,202,81,202,200,202,81,80,203,202,80,203,201,202,201,203,204,80,205,203,204,203,205,205,80,77,206,205,77,206,204,205,204,206,207,77,208,206,207,206,208,208,77,76,209,208,76,209,207,208,76,210,209,210,76,74,207,209,211,211,209,210,210,212,211,74,213,210,212,210,213,73,213,74,213,73,214,213,214,212,214,215,212,215,214,216,73,216,214,64,216,73,215,216,217,216,64,217,218,217,64,218,215,217,215,218,219,219,218,220,64,220,218,220,64,63,221,220,63,221,219,220,219,221,222,63,223,221,222,221,223,223,63,61,224,223,61,224,222,223,222,224,225,61,226,224,225,224,226,226,61,59,227,226,59,227,225,226,59,58,227,228,227,58,225,227,228,58,54,228,229,225,228,54,230,228,228,230,229,225,229,231,232,222,225,231,232,225,230,233,229,233,231,229,230,54,234,233,230,235,234,235,230,235,236,233,236,235,237,231,233,238,236,238,233,239,238,236,240,231,238,231,240,232,238,239,240,222,232,241,240,241,232,54,242,234,47,242,54,235,234,243,235,243,237,242,243,234,243,242,244,244,237,243,237,244,245,242,47,246,246,244,242,239,247,240,241,240,247,248,247,239,249,241,247,247,248,249,244,250,245,244,246,250,250,251,245,47,252,246,46,252,47,246,253,250,253,246,252,251,250,253,252,46,254,254,253,252,255,254,46,256,254,255,253,254,257,254,256,257,251,253,257,258,257,256,257,258,251,259,251,258,251,259,260,261,260,259,251,260,262,262,245,251,260,261,263,263,262,260,264,263,261,262,263,265,264,265,263,265,264,266,265,267,262,245,262,267,267,265,268,268,265,266,245,267,269,268,269,267,266,270,268,269,268,270,270,266,271,272,245,269,245,272,237,273,269,270,269,273,272,273,270,271,237,272,274,273,274,272,271,275,273,274,273,275,275,271,276,277,237,274,237,277,236,278,274,275,274,278,277,278,275,276,236,277,279,278,279,277,276,280,278,279,278,280,281,236,279,236,281,239,282,279,280,279,282,281,280,276,283,283,282,280,284,282,283,282,284,285,285,281,282,281,286,239,281,285,286,287,239,286,239,287,248,288,286,285,284,288,285,286,288,287,289,288,284,288,289,290,290,287,288,287,291,248,287,290,291,291,292,248,290,293,291,292,291,293,293,290,294,289,294,290,294,295,293,292,293,295,295,296,292,295,294,297,289,297,294,297,289,298,297,299,295,296,295,299,299,297,300,300,297,298,300,301,299,296,299,301,298,302,300,301,300,302,302,298,303,304,301,302,304,302,303,305,296,301,301,304,305,296,305,306,304,307,305,306,305,307,303,308,304,307,304,308,308,303,309,310,307,308,310,308,309,311,306,307,307,310,311,306,311,312,310,313,311,312,311,313,309,314,310,313,310,314,315,313,314,316,312,313,313,315,316,312,316,317,314,309,318,318,315,314,319,315,318,315,319,320,320,316,315,316,320,321,316,321,317,322,321,320,319,322,320,323,322,319,322,323,324,321,322,325,325,317,321,324,325,322,317,325,326,325,324,327,325,327,326,327,328,326,324,329,327,328,327,329,329,324,330,323,330,324,330,331,329,328,329,331,331,332,328,331,330,333,323,333,330,333,323,334,333,335,331,332,331,335,335,333,336,336,333,334,336,337,335,332,335,337,334,338,336,337,336,338,338,334,339,340,337,338,340,338,339,341,332,337,337,340,341,332,341,342,340,343,341,342,341,343,339,344,340,343,340,344,344,339,345,346,343,344,346,344,345,347,342,343,343,346,347,342,347,348,346,349,347,348,347,349,345,350,346,349,346,350,351,349,350,352,348,349,349,351,352,348,352,353,350,345,354,354,351,350,355,351,354,351,355,356,356,352,351,352,356,357,352,357,353,358,357,356,355,358,356,359,358,355,358,359,360,357,358,361,361,353,357,360,361,358,353,361,362,361,360,363,361,363,362,363,364,362,360,365,363,364,363,365,365,360,366,359,366,360,366,367,365,364,365,367,367,368,364,367,366,369,359,369,366,369,359,370,369,371,367,368,367,371,371,369,372,372,369,370,372,373,371,368,371,373,370,374,372,373,372,374,374,370,375,376,373,374,376,374,375,377,368,373,373,376,377,368,377,378,376,379,377,378,377,379,375,380,376,379,376,380,380,375,381,382,379,380,382,380,381,383,378,379,379,382,383,378,383,384,382,385,383,384,383,385,381,386,382,385,382,386,387,385,386,388,384,385,385,387,388,384,388,389,386,381,390,390,387,386,391,387,390,387,391,392,392,388,387,388,392,393,388,393,389,394,393,392,391,394,392,395,394,391,394,395,396,393,394,397,397,389,393,396,397,394,389,397,398,397,396,399,397,399,398,399,400,398,396,401,399,400,399,401,401,396,402,395,402,396,402,403,401,400,401,403,403,404,400,403,402,405,395,405,402,405,395,406,405,407,403,404,403,407,407,405,408,408,405,406,408,409,407,404,407,409,406,410,408,409,408,410,410,406,411,412,409,410,412,410,411,413,404,409,409,412,413,404,413,414,412,415,413,414,413,415,411,416,412,415,412,416,416,411,417,418,415,416,418,416,417,419,414,415,415,418,419,414,419,420,418,421,419,420,419,421,417,422,418,421,418,422,423,421,422,424,420,421,421,423,424,420,424,425,422,417,426,426,423,422,427,423,426,423,427,428,428,424,423,424,428,429,424,429,425,430,429,428,427,430,428,431,425,429,429,430,431,432,430,427,430,432,433,433,431,430,431,433,434,431,434,435,425,431,435,427,436,432,436,427,437,438,436,437,439,437,427,439,438,437,427,440,439,440,427,426,438,439,441,441,439,440,426,442,440,417,442,426,443,440,442,440,443,441,444,438,441,438,444,445,442,417,446,442,446,443,441,447,444,441,443,447,448,445,444,448,444,447,448,449,445,417,450,446,411,450,417,446,451,443,451,446,450,443,452,447,443,451,452,453,449,448,453,454,449,455,448,447,455,447,452,453,448,455,450,411,456,450,456,451,457,454,453,457,458,454,459,453,455,457,453,459,460,455,452,459,455,460,411,461,456,406,461,411,451,462,452,460,452,462,456,463,451,463,456,461,451,463,462,464,458,457,464,465,458,466,457,459,464,457,466,461,406,467,461,467,463,468,459,460,466,459,468,469,460,462,468,460,469,470,465,464,470,471,465,472,471,470,406,473,467,395,473,406,463,474,462,469,462,474,467,475,463,475,467,473,463,475,474,470,464,476,476,464,466,473,395,477,473,477,475,477,478,475,395,479,477,478,477,479,391,479,395,475,480,474,475,478,480,481,470,476,482,470,481,476,466,483,483,466,468,479,391,484,478,479,484,485,484,391,485,478,484,391,486,485,486,391,390,478,485,487,487,485,486,390,488,486,381,488,390,489,486,488,486,489,487,490,478,487,478,490,480,488,381,491,488,491,489,487,492,490,487,489,492,493,480,490,493,490,492,381,494,491,375,494,381,491,495,489,495,491,494,489,496,492,489,495,496,494,375,497,494,497,495,375,498,497,370,498,375,497,499,495,499,497,498,498,370,500,498,500,499,370,501,500,359,501,370,502,500,501,500,502,499,495,499,503,495,503,496,504,492,496,504,493,492,501,359,505,501,505,502,505,506,502,359,507,505,506,505,507,355,507,359,499,502,508,499,508,503,509,496,503,509,504,496,502,506,510,502,510,508,511,503,508,511,509,503,507,355,512,506,507,512,513,512,355,513,506,512,355,514,513,514,355,354,506,513,515,515,513,514,354,516,514,345,516,354,517,514,516,514,517,515,518,506,515,506,518,510,516,345,519,516,519,517,515,520,518,515,517,520,521,510,518,521,518,520,345,522,519,339,522,345,519,523,517,523,519,522,517,524,520,517,523,524,522,339,525,522,525,523,339,526,525,334,526,339,525,527,523,527,525,526,526,334,528,526,528,527,334,529,528,323,529,334,530,528,529,528,530,527,523,527,531,523,531,524,532,520,524,532,521,520,529,323,533,529,533,530,533,534,530,323,535,533,534,533,535,319,535,323,527,530,536,527,536,531,537,524,531,537,532,524,530,534,538,530,538,536,539,531,536,539,537,531,535,319,540,534,535,540,541,540,319,541,534,540,319,542,541,542,319,318,534,541,543,543,541,542,318,544,542,309,544,318,545,542,544,542,545,543,546,534,543,534,546,538,544,309,547,544,547,545,543,548,546,543,545,548,549,538,546,549,546,548,309,550,547,303,550,309,547,551,545,551,547,550,545,552,548,545,551,552,550,303,553,550,553,551,303,554,553,298,554,303,553,555,551,555,553,554,554,298,556,554,556,555,298,557,556,289,557,298,558,556,557,556,558,555,551,555,559,551,559,552,560,548,552,560,549,548,557,289,561,557,561,558,561,562,558,289,563,561,562,561,563,284,563,289,555,558,564,555,564,559,565,552,559,565,560,552,558,562,566,558,566,564,567,559,564,567,565,559,563,284,568,562,563,568,569,568,284,569,562,568,284,570,569,570,284,283,562,569,571,571,569,570,283,572,570,276,572,283,573,570,572,570,573,571,574,562,571,562,574,566,572,276,575,572,575,573,571,576,574,571,573,576,577,566,574,577,574,576,276,578,575,271,578,276,575,579,573,579,575,578,573,580,576,573,579,580,578,271,581,578,581,579,271,582,581,266,582,271,581,583,579,583,581,582,582,266,584,582,584,583,266,585,584,264,585,266,586,584,585,584,586,583,585,264,587,585,587,586,264,588,587,589,587,588,587,589,586,586,589,590,586,590,591,583,586,591,592,591,590,579,583,593,583,591,593,579,593,580,592,594,591,594,593,591,595,594,592,596,580,593,594,596,593,595,597,594,597,596,594,598,597,595,596,599,580,599,576,580,599,577,576,598,600,597,601,600,598,597,602,596,602,599,596,600,602,597,603,577,599,602,603,599,601,604,600,605,604,601,600,606,602,606,603,602,604,606,600,603,607,577,577,607,566,607,564,566,607,567,564,603,608,607,606,608,603,608,567,607,604,609,606,606,609,608,608,610,567,609,610,608,610,565,567,605,611,604,604,611,609,609,612,610,611,612,609,610,613,565,612,613,610,613,560,565,605,614,611,615,614,605,611,616,612,614,616,611,612,617,613,616,617,612,613,618,560,617,618,613,618,549,560,618,619,549,549,619,538,619,536,538,619,539,536,618,620,619,617,620,618,620,539,619,616,621,617,617,621,620,620,622,539,621,622,620,622,537,539,616,623,621,614,623,616,621,624,622,623,624,621,622,625,537,624,625,622,625,532,537,614,626,623,627,626,614,623,628,624,626,628,623,624,629,625,628,629,624,625,630,532,629,630,625,630,521,532,630,631,521,521,631,510,631,508,510,631,511,508,630,632,631,629,632,630,632,511,631,628,633,629,629,633,632,632,634,511,633,634,632,634,509,511,628,635,633,626,635,628,633,636,634,635,636,633,634,637,509,636,637,634,637,504,509,626,481,635,638,481,626,481,639,635,635,639,636,481,476,639,639,476,483,639,640,636,636,640,637,639,483,640,637,641,504,640,641,637,641,493,504,640,483,642,640,642,641,483,468,642,642,468,469,641,643,493,641,642,643,642,469,643,493,643,480,643,469,474,643,474,480,241,644,222,241,249,644,644,219,222,249,645,644,219,644,645,645,249,646,248,646,249,645,647,219,646,647,645,248,648,646,647,646,648,648,248,292,649,219,647,219,649,215,650,647,648,292,650,648,647,650,649,215,649,651,650,651,649,292,652,650,651,650,652,652,292,296,653,652,296,653,651,652,306,653,296,654,215,651,651,653,654,215,654,212,653,306,655,655,654,653,212,654,656,654,655,656,657,655,306,657,656,655,312,657,306,658,212,656,656,657,658,212,658,211,657,312,659,659,658,657,211,658,660,658,659,660,660,207,211,312,661,659,317,661,312,659,662,660,207,660,662,662,659,661,661,317,663,663,662,661,662,664,207,662,663,664,664,204,207,317,665,663,326,665,317,663,666,664,204,664,666,666,663,665,666,667,204,667,201,204,668,666,665,666,668,667,665,326,668,668,669,667,201,667,669,326,670,668,669,668,670,669,671,201,670,671,669,326,672,670,671,670,672,672,326,328,673,201,671,201,673,197,674,671,672,328,674,672,671,674,673,197,673,675,674,675,673,328,676,674,675,674,676,676,328,332,677,676,332,677,675,676,342,677,332,678,197,675,675,677,678,197,678,194,677,342,679,679,678,677,194,678,680,678,679,680,681,679,342,681,680,679,348,681,342,682,194,680,680,681,682,194,682,193,681,348,683,683,682,681,193,682,684,682,683,684,684,189,193,348,685,683,353,685,348,683,686,684,189,684,686,686,683,685,685,353,687,687,686,685,686,688,189,686,687,688,688,186,189,353,689,687,362,689,353,687,690,688,186,688,690,690,687,689,690,691,186,691,183,186,692,690,689,690,692,691,689,362,692,692,693,691,183,691,693,362,694,692,693,692,694,693,695,183,694,695,693,362,696,694,695,694,696,696,362,364,697,183,695,183,697,179,698,695,696,364,698,696,695,698,697,179,697,699,698,699,697,364,700,698,699,698,700,700,364,368,701,700,368,701,699,700,378,701,368,702,179,699,699,701,702,179,702,176,701,378,703,703,702,701,176,702,704,702,703,704,705,703,378,705,704,703,384,705,378,706,176,704,704,705,706,176,706,175,705,384,707,707,706,705,175,706,708,706,707,708,708,171,175,384,709,707,389,709,384,707,710,708,171,708,710,710,707,709,709,389,711,711,710,709,710,712,171,710,711,712,712,168,171,389,713,711,398,713,389,711,714,712,168,712,714,714,711,713,714,715,168,715,165,168,716,714,713,714,716,715,713,398,716,716,717,715,165,715,717,398,718,716,717,716,718,717,719,165,718,719,717,398,720,718,719,718,720,720,398,400,721,165,719,165,721,161,722,719,720,400,722,720,719,722,721,161,721,723,722,723,721,400,724,722,723,722,724,724,400,404,725,724,404,725,723,724,414,725,404,726,161,723,723,725,726,161,726,159,725,414,727,727,726,725,728,727,414,420,728,414,726,727,729,159,726,729,728,729,727,730,159,729,729,728,730,728,420,731,731,730,728,159,730,732,157,159,732,420,733,731,425,733,420,730,731,734,732,730,734,734,735,732,732,736,157,735,736,732,154,157,736,731,737,734,737,731,733,735,734,737,736,738,154,736,735,738,738,148,154,733,425,739,739,737,733,148,738,740,735,740,738,741,740,735,737,742,735,737,739,742,742,741,735,740,743,148,740,741,743,743,142,148,142,743,744,741,744,743,744,745,142,744,746,745,746,744,741,425,747,739,435,747,425,739,748,742,741,742,748,748,739,747,749,746,741,748,749,741,746,749,750,747,435,751,751,748,747,748,751,749,751,750,749,435,752,751,750,751,752};
		
		private static Mesh _SkySphere;
        private static Mesh SkySphere
        {
            get
            {
                if (!_SkySphere)
                {
                    _SkySphere = new Mesh();
                    _SkySphere.vertices = skySphereVertices;
					_SkySphere.triangles = skySphereTriangles;
                    //Note: No need for normals for skybox shaders
                    
                    _SkySphere.hideFlags = HideFlags.DontSave;
                }
                return _SkySphere;
            }
        }
        
        public override void Render(PostProcessRenderContext context)
        {
            PropertySheet sheet = context.propertySheets.Get(shader);
            CommandBuffer cmd = context.command;

            Camera cam = context.camera;

            #region Skybox sampling
            if (settings.colorSource.value == Fog.FogColorSource.SkyboxColor)
            {
				//Note: Bugged in Forward rendering for the scene-view camera when using the default procedural sky.
                cmd.GetTemporaryRT(skyboxTexID, context.width / 2, context.height / 2, 0, FilterMode.Bilinear, context.sourceFormat);
                cmd.SetRenderTarget(skyboxTexID);

                cmd.DrawMesh(SkySphere, Matrix4x4.TRS(cam.transform.position, Quaternion.identity, Vector3.one * (cam.farClipPlane-10f)), RenderSettings.skybox, 0, 0);
            }
            #endregion

            #region Property value composition

            float FdotC = cam.transform.position.y - settings.height;
            float paramK = (FdotC <= 0.0f ? 1.0f : 0.0f);
            //Always exclude skybox for skybox color mode
            //Always include when using light scattering to avoid depth discontinuity
            float skyboxInfluence = (settings.lightScattering) ? 1.0f : settings.skyboxInfluence;
            float distanceFog = (settings.distanceFog) ? 1.0f : 0.0f;
            float heightFog = (settings.heightFog) ? 1.0f : 0.0f;

            int colorSource = (settings.useSceneSettings) ? 0 : (int)settings.colorSource.value;
            var sceneMode = (settings.useSceneSettings) ? RenderSettings.fogMode : settings.fogMode;
            var sceneDensity = (settings.useSceneSettings) ? RenderSettings.fogDensity : settings.globalDensity / 100;
            var sceneStart = (settings.useSceneSettings) ? RenderSettings.fogStartDistance : settings.fogStartDistance;
            var sceneEnd = (settings.useSceneSettings) ? RenderSettings.fogEndDistance : settings.fogEndDistance;

            bool linear = (sceneMode == FogMode.Linear);
            float diff = linear ? sceneEnd - sceneStart : 0.0f;
            float invDiff = Mathf.Abs(diff) > 0.0001f ? 1.0f / diff : 0.0f;

            Vector4 sceneParams;
            sceneParams.x = sceneDensity * 1.2011224087f; // density / sqrt(ln(2)), used by Exp2 fog mode
            sceneParams.y = sceneDensity * 1.4426950408f; // density / ln(2), used by Exp fog mode
            sceneParams.z = linear ? -invDiff : 0.0f;
            sceneParams.w = linear ? sceneEnd * invDiff : 0.0f;

            float gradientDistance = (settings.gradientUseFarClipPlane.value) ? settings.gradientDistance : context.camera.farClipPlane;
            #endregion

            #region Property assignment
            if (settings.heightNoiseTex.value) sheet.properties.SetTexture("_NoiseTex", settings.heightNoiseTex);
            if (settings.fogColorGradient.value) sheet.properties.SetTexture("_ColorGradient", settings.fogColorGradient);
            cmd.SetGlobalFloat("_FarClippingPlane", gradientDistance);
            cmd.SetGlobalVector("_SceneFogParams", sceneParams);
            cmd.SetGlobalVector("_SceneFogMode", new Vector4((int)sceneMode, settings.useRadialDistance ? 1 : 0, colorSource, settings.heightFogNoise ? 1 : 0));
            cmd.SetGlobalVector("_NoiseParams", new Vector4(settings.heightNoiseSize * 0.01f, settings.heightNoiseSpeed * 0.01f, settings.heightNoiseStrength, 0));
            cmd.SetGlobalVector("_DensityParams", new Vector4(settings.distanceDensity, settings.heightNoiseStrength, settings.skyboxMipLevel, 0));
            cmd.SetGlobalVector("_HeightParams", new Vector4(settings.height, FdotC, paramK, settings.heightDensity * 0.5f));
            cmd.SetGlobalVector("_DistanceParams", new Vector4(-sceneStart, 0f, distanceFog, heightFog));
            cmd.SetGlobalColor("_FogColor", (settings.useSceneSettings) ? RenderSettings.fogColor : settings.fogColor);
            cmd.SetGlobalVector("_SkyboxParams", new Vector4(skyboxInfluence, settings.skyboxMipLevel, 0, 0));

            Vector3 sunDir = (settings.useLightDirection && RenderSettings.sun) ? -RenderSettings.sun.transform.forward : settings.lightDirection.value.normalized;
            float sunIntensity = (settings.useLightIntensity && RenderSettings.sun) ? RenderSettings.sun.intensity : settings.lightIntensity.value;
            sunIntensity = (settings.enableDirectionalLight) ? sunIntensity : 0f;
            cmd.SetGlobalVector("_DirLightParams", new Vector4(sunDir.x, sunDir.y, sunDir.z, sunIntensity));

            Color sunColor = (settings.useLightColor && RenderSettings.sun) ? RenderSettings.sun.color : settings.lightColor.value;
            cmd.SetGlobalVector("_DirLightColor", new Vector4(sunColor.r, sunColor.g, sunColor.b, 0));

            #endregion

            #region Light scattering
            //Repurpose parts of the bloom effect
            bool enableScattering = (settings.lightScattering) ? true : false;

            if (enableScattering)
            {
                int tw = Mathf.FloorToInt(context.screenWidth / (2f));
                int th = Mathf.FloorToInt(context.screenHeight / (2f));
                bool singlePassDoubleWide = (context.stereoActive && (context.stereoRenderingMode == PostProcessRenderContext.StereoRenderingMode.SinglePass) && (context.camera.stereoTargetEye == StereoTargetEyeMask.Both));
                int tw_stereo = singlePassDoubleWide ? tw * 2 : tw;

                // Determine the iteration count
                int s = Mathf.Max(tw, th);
                float logs = Mathf.Log(s, 2f) + Mathf.Min(settings.scatterDiffusion.value, 10f) - 10f;
                int logs_i = Mathf.FloorToInt(logs);
                int iterations = Mathf.Clamp(logs_i, 1, k_MaxPyramidSize);
                float sampleScale = 0.5f + logs - logs_i;
                sheet.properties.SetFloat("_SampleScale", sampleScale);

                // Prefiltering parameters
                float lthresh = Mathf.GammaToLinearSpace(settings.scatterThreshold.value);
                float knee = lthresh * settings.scatterSoftKnee.value + 1e-5f;
                var threshold = new Vector4(lthresh, lthresh - knee, knee * 2f, 0.25f / knee);
                cmd.SetGlobalVector("_Threshold", threshold);

                // Downsample
                var lastDown = context.source;
                for (int i = 0; i < iterations; i++)
                {
                    int mipDown = m_Pyramid[i].down;
                    int mipUp = m_Pyramid[i].up;
                    int pass = i == 0 ? (int)Pass.Prefilter : (int)Pass.Downsample;

                    context.GetScreenSpaceTemporaryRT(cmd, mipDown, 0, context.sourceFormat, RenderTextureReadWrite.Default, FilterMode.Bilinear, tw_stereo, th);
                    context.GetScreenSpaceTemporaryRT(cmd, mipUp, 0, context.sourceFormat, RenderTextureReadWrite.Default, FilterMode.Bilinear, tw_stereo, th);
                    cmd.BlitFullscreenTriangle(lastDown, mipDown, sheet, pass);

                    lastDown = mipDown;
                    tw_stereo = (singlePassDoubleWide && ((tw_stereo / 2) % 2 > 0)) ? 1 + tw_stereo / 2 : tw_stereo / 2;
                    tw_stereo = Mathf.Max(tw_stereo, 1);
                    th = Mathf.Max(th / 2, 1);
                }

                // Upsample
                int lastUp = m_Pyramid[iterations - 1].down;
                for (int i = iterations - 2; i >= 0; i--)
                {
                    int mipDown = m_Pyramid[i].down;
                    int mipUp = m_Pyramid[i].up;
                    cmd.SetGlobalTexture("_BloomTex", mipDown);
                    cmd.BlitFullscreenTriangle(lastUp, mipUp, sheet, (int)Pass.Upsample);
                    lastUp = mipUp;
                }

                float intensity = RuntimeUtilities.Exp2(settings.scatterIntensity.value / 10f) - 1f;
                var shaderSettings = new Vector4(sampleScale, intensity, 0, iterations);
                cmd.SetGlobalVector("_ScatteringParams", shaderSettings);

                cmd.SetGlobalTexture("_BloomTex", lastUp);

                // Cleanup
                for (int i = 0; i < iterations; i++)
                {
                    if (m_Pyramid[i].down != lastUp)
                        cmd.ReleaseTemporaryRT(m_Pyramid[i].down);
                    if (m_Pyramid[i].up != lastUp)
                        cmd.ReleaseTemporaryRT(m_Pyramid[i].up);
                }
                
                if (settings.colorSource.value == Fog.FogColorSource.SkyboxColor) cmd.ReleaseTemporaryRT(skyboxTexID);
            }

            #endregion

            #region shader passes
            context.command.BlitFullscreenTriangle(context.source, context.destination, sheet, enableScattering ? (int)Pass.BlendScattering : (int)Pass.Blend);
            #endregion

        }

        public override DepthTextureMode GetCameraFlags()
        {
            return DepthTextureMode.Depth;
        }
    }
}